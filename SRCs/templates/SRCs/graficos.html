{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard de Envios</title>

    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'SRCs/css/graficos.css' %}" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    {% include 'SRCs/menu_lateral_oculto.html' %}
    {% include 'SRCs/icone_user.html' %}
    <h1>Dashboard de Envios</h1>

    <!-- Filtros -->
    <form method="get" class="filtro-form">
        <label for="data_inicio">Data inicial:</label>
        <input type="date" name="data_inicio" id="data_inicio" value="{{ request.GET.data_inicio }}">

        <label for="data_fim">Data final:</label>
        <input type="date" name="data_fim" id="data_fim" value="{{ request.GET.data_fim }}">

        <label for="filtro_unidade">Unidade:</label>
        <select name="filtro_unidade" id="filtro_unidade">
            <option value="">Todas</option>
            {% for unidade in unidades %}
                <option value="{{ unidade.id }}" {% if request.GET.filtro_unidade == unidade.id|stringformat:"s" %}selected{% endif %}>{{ unidade.shopping }}</option>
            {% endfor %}
        </select>

        <label for="filtro_usuario">Usuário:</label>
        <select name="filtro_usuario" id="filtro_usuario">
            <option value="">Todos</option>
            {% for usuario in usuarios_list %}
                <option value="{{ usuario.id }}" {% if request.GET.filtro_usuario == usuario.id|stringformat:"s" %}selected{% endif %}>{{ usuario.username }}</option>
            {% endfor %}
        </select>

        <button type="submit">Filtrar</button>
        <a href="{% url 'dashboard' %}" class="btn-limpar">Limpar</a>
    </form>

    <!-- Grid de gráficos -->
    <div class="graficos-grid">
        <div class="grafico-card">
            <h2>Quantidade de envios por mês</h2>
            <canvas id="graficoEnvios"></canvas>
        </div>

        <div class="grafico-card">
            <h2>Envios por lojas (remetente)</h2>
            <canvas id="graficoRemetentes"></canvas>
        </div>

        <div class="grafico-card">
            <h2>Envios recebidos por loja (destinatário)</h2>
            <canvas id="graficoDestinatarios"></canvas>
        </div>

        <div class="grafico-card">
            <h2>Gastos por unidade (destinatário)</h2>
            <canvas id="graficoGastosUnidade"></canvas>
        </div>

        <div class="grafico-card">
            <h2>Envios por usuário</h2>
            <canvas id="graficoEnviosUsuario"></canvas>
        </div>
    </div>

    <!-- Modal para ampliar gráfico -->
    <div id="modalGrafico" class="modal-grafico">
        <div class="modal-grafico-content">
            <span id="fecharModal" class="modal-grafico-close">&times;</span>
            <canvas id="graficoModal"></canvas>
        </div>
    </div>

    <!-- Dados para o JS -->
    <script>
        window.dashboardData = {
            enviosLabels: {{ labels|default:"[]"|safe }},
            enviosValores: {{ valores|default:"[]"|safe }},
            remetentesLabels: {{ remetentes|default:"[]"|safe }},
            remetentesValores: {{ qtd_envios|default:"[]"|safe }},
            destinatariosLabels: {{ destinatarios|default:"[]"|safe }},
            destinatariosValores: {{ qtd_destinatarios|default:"[]"|safe }},
            gastosLabels: {{ unidades_destino|default:"[]"|safe }},
            gastosValores: {{ valores_gastos|default:"[]"|safe }},
            usuariosLabels: {{ usuarios|default:"[]"|safe }},
            usuariosValores: {{ qtd_envios_usuario|default:"[]"|safe }},
        }
    </script>

    <script src="{% static 'SRCs/js/graficos.js' %}"></script>
</body>
</html>
