{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{% static 'SRCs/css/form_user.css' %}">
    <title>Cadastro de Usuário</title>
</head>
<body>
    {% include 'SRCs/menu_lateral_oculto.html' %}
    {% include 'SRCs/icone_user.html' %}
    
    <h1>Cadastro de Usuário</h1>
    
    <div class="container-form">
        <form action="{% url 'cadastro_user' %}" method="POST">
            {% csrf_token %}

            <div class="campo">
                <label for="{{ form.username.id_for_label }}">{{ form.username.label }}</label>
                {{ form.username }}
                {% if form.username.errors %}
                    <div class="error">{{ form.username.errors|striptags }}</div>
                {% endif %}
            </div>

            <div class="campo">
                <label for="{{ form.email.id_for_label }}">{{ form.email.label }}</label>
                {{ form.email }}
                {% if form.email.errors %}
                    <div class="error">{{ form.email.errors|striptags }}</div>
                {% endif %}
            </div>

            <div class="campo">
                <label for="{{ form.password.id_for_label }}">{{ form.password.label }}</label>
                {{ form.password }}
                <ul id="password-requirements" style="font-size: 0.85rem; margin-top: 6px; list-style: none; padding-left: 0;">
                    <li id="req-length" style="color: red;">❌ Pelo menos 8 caracteres</li>
                    <li id="req-letter" style="color: red;">❌ Pelo menos 1 letra</li>
                    <li id="req-number" style="color: red;">❌ Pelo menos 1 número</li>
                    <li id="req-special" style="color: red;">❌ Pelo menos 1 caractere especial (@$!%*?&)</li>
                </ul>
                {% if form.password.errors %}
                    <div class="error">{{ form.password.errors|striptags }}</div>
                {% endif %}
            </div>

            <div class="campo">
                <label for="{{ form.confirmar_senha.id_for_label }}">{{ form.confirmar_senha.label }}</label>
                {{ form.confirmar_senha }}
                <div id="senha-match" style="font-size: 0.85rem; margin-top: 6px; color: red; display: none;">
                    ❌ As senhas não coincidem
                </div>
                {% if form.confirmar_senha.errors %}
                    <div class="error">{{ form.confirmar_senha.errors|striptags }}</div>
                {% endif %}
            </div>

            <div class="campo">
                <label for="{{ form.perfil.id_for_label }}">{{ form.perfil.label }}</label>
                {{ form.perfil }}
                {% if form.perfil.errors %}
                    <div class="error">{{ form.perfil.errors }}</div>
                {% endif %}
            </div>

            <div class="campo">
                <label for="{{ form.cartao_postagem.id_for_label }}">{{ form.cartao_postagem.label }}</label>
                {{ form.cartao_postagem }}
                {% if form.cartao_postagem.errors %}
                    <div class="error">{{ form.cartao_postagem.errors }}</div>
                {% endif %}
            </div>

            <div class="campo">
                <label for="{{ form.unidade.id_for_label }}">{{ form.unidade.label }}</label>
                {{ form.unidade }}
                {% if form.unidade.errors %}
                    <div class="error">{{ form.unidade.errors }}</div>
                {% endif %}
            </div>

            <div style="margin-top: 20px; text-align: center;">
                <button type="submit">Cadastrar</button>
                <button type="button" id="btn-limpar">Limpar</button>
            </div>
        </form>
    </div>

    <script>
    const btnLimpar = document.getElementById("btn-limpar");
    const form = document.querySelector("form");
    const passwordInput = document.getElementById("id_password");
    const confirmInput = document.getElementById("id_confirmar_senha");
    const reqLength = document.getElementById("req-length");
    const reqLetter = document.getElementById("req-letter");
    const reqNumber = document.getElementById("req-number");
    const reqSpecial = document.getElementById("req-special");
    const matchMessage = document.getElementById("senha-match");

    // Validação da senha
    passwordInput.addEventListener("input", () => {
        const value = passwordInput.value;

        reqLength.style.color = value.length >= 8 ? "green" : "red";
        reqLength.textContent = value.length >= 8 ? "✔ Pelo menos 8 caracteres" : "❌ Pelo menos 8 caracteres";

        reqLetter.style.color = /[A-Za-z]/.test(value) ? "green" : "red";
        reqLetter.textContent = /[A-Za-z]/.test(value) ? "✔ Pelo menos 1 letra" : "❌ Pelo menos 1 letra";

        reqNumber.style.color = /\d/.test(value) ? "green" : "red";
        reqNumber.textContent = /\d/.test(value) ? "✔ Pelo menos 1 número" : "❌ Pelo menos 1 número";

        reqSpecial.style.color = /[@$!%*?&]/.test(value) ? "green" : "red";
        reqSpecial.textContent = /[@$!%*?&]/.test(value) ? "✔ Pelo menos 1 caractere especial (@$!%*?&)" : "❌ Pelo menos 1 caractere especial (@$!%*?&)";
    });

    // Confirmação de senha
    confirmInput.addEventListener("input", () => {
        if (confirmInput.value === "") {
            matchMessage.style.display = "none";
        } else if (confirmInput.value === passwordInput.value) {
            matchMessage.style.display = "block";
            matchMessage.style.color = "green";
            matchMessage.textContent = "✔ As senhas coincidem";
        } else {
            matchMessage.style.display = "block";
            matchMessage.style.color = "red";
            matchMessage.textContent = "❌ As senhas não coincidem";
        }
    });

    // Botão Limpar
    btnLimpar.addEventListener("click", () => {
        form.reset();

        // Reset mensagens de erro
        document.querySelectorAll(".error").forEach(e => e.textContent = "");

        // Reset requisitos de senha
        reqLength.style.color = "red";
        reqLength.textContent = "❌ Pelo menos 8 caracteres";

        reqLetter.style.color = "red";
        reqLetter.textContent = "❌ Pelo menos 1 letra";

        reqNumber.style.color = "red";
        reqNumber.textContent = "❌ Pelo menos 1 número";

        reqSpecial.style.color = "red";
        reqSpecial.textContent = "❌ Pelo menos 1 caractere especial (@$!%*?&)";

        // Reset mensagem de confirmação de senha
        matchMessage.style.display = "none";
    });
    </script>
</body>
</html>
